<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>üíï Will You Be My Valentine MJ? üíï</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root{
      --bg1:#0f0713;
      --bg2:#220a2a;
      --bg3:#0f0713;
      --pink:#ff6b9d;
      --pink2:#ff8fab;
      --rose:#ffc8dd;
      --txt:rgba(255,220,235,.92);
      --muted:rgba(255,220,235,.78);
      --border:rgba(255,200,221,.28);
      --shadow:rgba(255,107,157,.25);
      --safeTop: env(safe-area-inset-top);
      --safeBottom: env(safe-area-inset-bottom);
    }

    body{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:"Quicksand",sans-serif;

      /* allow scroll */
      overflow-x:hidden;
      overflow-y:auto;

      background: radial-gradient(1200px 800px at 20% 15%, rgba(255,107,157,.22), transparent 55%),
                  radial-gradient(900px 700px at 80% 70%, rgba(255,200,221,.16), transparent 55%),
                  linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 52%, var(--bg3) 100%);
      perspective: 1200px;
      padding: 24px;
    }

    /* dreamy animated glow fog */
    .fog{
      position:fixed; inset:-30%;
      background:
        radial-gradient(closest-side, rgba(255,107,157,.14), transparent 60%),
        radial-gradient(closest-side, rgba(255,200,221,.10), transparent 60%),
        radial-gradient(closest-side, rgba(255,255,255,.06), transparent 60%);
      filter: blur(50px);
      animation: fogMove 14s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:0;
      opacity:.9;
    }
    @keyframes fogMove{
      0%{ transform: translate(-3%, -2%) rotate(0deg) scale(1.05); }
      100%{ transform: translate(3%, 2%) rotate(8deg) scale(1.12); }
    }

    /* Floating hearts background */
    .hearts-container{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:1;
    }
    .floating-heart{
      position:absolute;
      font-size: 2rem;
      animation: floatUp 8s ease-in-out infinite;
      opacity:.6;
      filter: blur(.6px) drop-shadow(0 10px 18px rgba(255,107,157,.25));
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{ transform: translateY(110vh) rotate(0deg) scale(.5); opacity:0; }
      12%{ opacity:.65; }
      88%{ opacity:.65; }
      100%{ transform: translateY(-120vh) rotate(360deg) scale(1.25); opacity:0; }
    }

    /* main card */
    .card-container{
      position:relative;
      z-index:10;
      transform-style:preserve-3d;
      animation: cardFloat 6s ease-in-out infinite;
      will-change: transform;
    }
    @keyframes cardFloat{
      0%,100%{ transform: translateY(0) rotateX(6deg) rotateY(-6deg); }
      50%{ transform: translateY(-18px) rotateX(-4deg) rotateY(5deg); }
    }

    .card{
      width:min(720px, 92vw);
      background: linear-gradient(145deg, rgba(255,105,135,.14), rgba(255,255,255,.06), rgba(255,105,135,.12));
      backdrop-filter: blur(18px);
      border: 1px solid var(--border);
      border-radius: 34px;
      padding: 58px 64px;
      text-align:center;
      box-shadow:
        0 30px 70px rgba(0,0,0,.45),
        0 0 120px var(--shadow),
        inset 0 0 60px rgba(255,200,221,.08);
      position:relative;
      transform-style:preserve-3d;
      overflow:visible;
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      border-radius: 36px;
      background: linear-gradient(45deg, #ff6b9d, #ff8fab, #ffc8dd, #ff6b9d);
      opacity:.45;
      z-index:-1;
      filter: blur(.2px);
      animation:borderGlow 3s ease-in-out infinite;
    }
    @keyframes borderGlow{
      0%,100%{ opacity:.28; }
      50%{ opacity:.70; }
    }

    /* cute bow sparkles on top */
    .top-bow{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-bottom: 14px;
      transform: translateZ(40px);
    }
    .top-bow .mini{
      font-size: 1.35rem;
      opacity:.95;
      filter: drop-shadow(0 10px 20px rgba(255,107,157,.35));
      animation: twinkle 1.8s ease-in-out infinite;
    }
    .top-bow .mini:nth-child(2){ animation-delay:.25s; }
    .top-bow .mini:nth-child(3){ animation-delay:.5s; }
    @keyframes twinkle{
      0%,100%{ transform: translateY(0) scale(1); opacity:.85; }
      50%{ transform: translateY(-5px) scale(1.08); opacity:1; }
    }

    .heart-3d{
      font-size: 5.2rem;
      margin: 6px 0 18px;
      display:inline-block;
      animation: heartbeat 1.35s ease-in-out infinite;
      filter: drop-shadow(0 12px 35px rgba(255,107,157,.55));
      transform: translateZ(60px);
    }
    @keyframes heartbeat{
      0%,100%{ transform: translateZ(60px) scale(1); }
      22%{ transform: translateZ(70px) scale(1.16); }
      48%{ transform: translateZ(60px) scale(1); }
      74%{ transform: translateZ(70px) scale(1.10); }
    }

    h1{
      font-family:"Playfair Display", serif;
      font-size: clamp(2.1rem, 4vw, 3.2rem);
      background: linear-gradient(135deg, #fff, var(--rose), var(--pink2));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom: 12px;
      letter-spacing: 1.8px;
      transform: translateZ(35px);
      text-shadow: 0 0 40px rgba(255,182,193,.35);
    }

    .subtitle{
      font-size: clamp(1.0rem, 2vw, 1.25rem);
      color: var(--muted);
      margin-bottom: 34px;
      font-weight: 400;
      transform: translateZ(24px);
      line-height:1.55;
    }

    /* buttons */
    .buttons-container{
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 22px;
      min-height: 86px;
      position:relative;
      transform: translateZ(46px);
    }

    .btn{
      padding: 16px 44px;
      border:none;
      border-radius: 999px;
      cursor:pointer;
      font-family:"Quicksand", sans-serif;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-size: 1.05rem;
      transition: transform .22s ease, box-shadow .22s ease, filter .22s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .btn-yes{
      background: linear-gradient(135deg, var(--pink), var(--pink2), var(--pink));
      color:white;
      box-shadow: 0 14px 45px rgba(255,107,157,.35), 0 0 35px rgba(255,107,157,.25);
      position:relative;
      overflow:hidden;
    }
    .btn-yes:hover{
      transform: translateY(-4px) scale(1.06);
      filter: brightness(1.05);
      box-shadow: 0 22px 70px rgba(255,107,157,.45), 0 0 55px rgba(255,107,157,.33);
    }

    /* No stays visible and moves around on attempts */
    .btn-no{
      background: linear-gradient(135deg, rgba(90,79,101,.95), rgba(58,48,69,.95));
      color: rgba(255,255,255,.82);
      box-shadow: 0 8px 26px rgba(0,0,0,.35);
      position: relative;
      will-change: left, top, transform;
    }
    .btn-no:hover{ filter: brightness(1.08); }

    /* ‚úÖ Ensure NO is NEVER behind anything */
    #noBtn{ z-index: 2147483647 !important; }

    .hint{
      margin-top: 18px;
      color: rgba(255,220,235,.78);
      font-size: .98rem;
      transform: translateZ(26px);
    }
    .hint b{ color: rgba(255,220,235,.95); }

    /* success */
    .success-message{ display:none; }
    .success-message.show{
      display:block;
      animation: successPop .65s cubic-bezier(.68,-0.55,.265,1.55) forwards;
      transform-style: preserve-3d;
    }
    @keyframes successPop{
      0%{ transform: scale(.2) translateZ(70px); opacity:0; }
      100%{ transform: scale(1) translateZ(70px); opacity:1; }
    }
    .success-message h2{
      font-family:"Playfair Display", serif;
      font-size: clamp(2rem, 3.6vw, 2.7rem);
      background: linear-gradient(135deg, #fff, var(--rose));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin: 12px 0 10px;
      text-shadow: 0 0 40px rgba(255,182,193,.25);
    }
    .success-message p{
      color: rgba(255,220,235,.9);
      font-size: 1.12rem;
      line-height:1.5;
      white-space: pre-wrap;
    }

    /* particles */
    .sparkle{
      position:fixed;
      pointer-events:none;
      font-size: 1.45rem;
      animation: sparkleFloat 1s ease-out forwards;
      z-index: 2147483646;
      filter: drop-shadow(0 10px 16px rgba(255,107,157,.28));
    }
    @keyframes sparkleFloat{
      0%{ transform: scale(0) rotate(0deg); opacity:1; }
      100%{ transform: scale(1.05) rotate(180deg) translateY(-110px); opacity:0; }
    }

    .confetti{
      position:fixed;
      width: 10px; height: 10px;
      pointer-events:none;
      z-index: 2147483645;
      animation: confettiFall 3s ease-out forwards;
    }
    @keyframes confettiFall{
      0%{ transform: translateY(-120vh) rotate(0deg); opacity:1; }
      100%{ transform: translateY(120vh) rotate(720deg); opacity:0; }
    }

    /* üíû heart trail behind No */
    .trail-heart{
      position: fixed;
      pointer-events: none;
      z-index: 2147483644;
      filter: drop-shadow(0 10px 16px rgba(255,107,157,.25));
      opacity: .95;
      animation: trailFade .55s ease-out forwards;
    }
    @keyframes trailFade{
      0%{ transform: translate(-50%, -50%) scale(.6) rotate(0deg); opacity: 0.9; }
      100%{ transform: translate(-50%, -50%) scale(1.35) rotate(12deg); opacity: 0; }
    }

    /* ‚ö†Ô∏è popup warnings */
    .popup{
      position: fixed;
      left: 50%;
      top: calc(18px + var(--safeTop));
      transform: translateX(-50%);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,200,221,.22);
      backdrop-filter: blur(14px);
      padding: 12px 14px;
      border-radius: 14px;
      color: rgba(255,230,242,.92);
      font-weight: 700;
      letter-spacing: .5px;
      z-index: 2147483643;
      box-shadow: 0 18px 50px rgba(0,0,0,.35), 0 0 40px rgba(255,107,157,.18);
      animation: popIn .22s ease-out forwards;
      max-width: min(520px, 92vw);
      text-align: center;
    }
    .popup.out{ animation: popOut .22s ease-in forwards; }
    @keyframes popIn{
      from{ opacity:0; transform: translateX(-50%) translateY(-10px) scale(.98); }
      to{ opacity:1; transform: translateX(-50%) translateY(0) scale(1); }
    }
    @keyframes popOut{
      to{ opacity:0; transform: translateX(-50%) translateY(-10px) scale(.98); }
    }

    /* üéµ music button */
    .music-toggle{
      position: fixed;
      right: 16px;
      top: calc(16px + var(--safeTop));
      z-index: 2147483642;
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,200,221,.22);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(14px);
      color: rgba(255,230,242,.92);
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 18px 50px rgba(0,0,0,.28);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .music-toggle .dot{
      width:10px; height:10px;
      border-radius: 999px;
      background: rgba(255,255,255,.4);
      box-shadow: 0 0 16px rgba(255,107,157,.35);
    }
    .music-toggle.on .dot{
      background: rgba(255,107,157,.95);
      box-shadow: 0 0 18px rgba(255,107,157,.55);
    }

    .initial-content.hidden{ display:none; }

    @media (max-width: 600px){
      .card{ padding: 44px 26px; border-radius: 28px; }
      .btn{ padding: 14px 32px; font-size: .95rem; }
      .buttons-container{ gap: 16px; min-height: 78px; }
      .heart-3d{ font-size: 4.2rem; }
    }

    /* üé• Surprise button + video */
    .surprise-wrap{
      margin-top: 18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 16px;
    }
    .video-wrap{
      width: min(640px, 92vw);
      animation: videoIn .35s ease-out forwards;
    }
    @keyframes videoIn{
      from{ opacity:0; transform: translateY(10px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .video-frame{
      border-radius: 22px;
      overflow:hidden;
      border: 1px solid rgba(255,200,221,.25);
      background: rgba(0,0,0,.25);
      box-shadow: 0 24px 70px rgba(0,0,0,.45), 0 0 60px rgba(255,107,157,.18);
    }
    .video-frame video{
      width:100%;
      height:auto;
      display:block;
      max-height: 80vh;
    }

    /* üéÅ Gift reveal styles */
    .gift-wrap{
      margin-top: 18px;
      width: min(640px, 92vw);
    }

    .gift-card{
      border-radius: 22px;
      padding: 18px 16px;
      border: 1px solid rgba(255,200,221,.22);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(14px);
      box-shadow: 0 24px 70px rgba(0,0,0,.35), 0 0 60px rgba(255,107,157,.16);
      animation: giftIn .35s ease-out forwards;
    }

    @keyframes giftIn{
      from{ opacity:0; transform: translateY(10px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .gift-top{
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:center;
      margin-bottom: 6px;
    }

    .gift-icon{
      font-size: 2.2rem;
      filter: drop-shadow(0 12px 24px rgba(255,107,157,.25));
      animation: giftBounce 1.2s ease-in-out infinite;
    }

    @keyframes giftBounce{
      0%,100%{ transform: translateY(0) rotate(0deg); }
      50%{ transform: translateY(-6px) rotate(-4deg); }
    }

    .gift-title{
      font-weight: 900;
      color: rgba(255,230,242,.95);
      letter-spacing: .3px;
      font-size: 1.1rem;
    }

    .gift-sub{
      text-align:center;
      color: rgba(255,220,235,.82);
      margin: 8px 0 14px;
    }

    .gift-btn{
      display:block;
      margin: 0 auto;
    }

    .gift-reveal{
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,200,221,.18);
      text-align:center;
    }

    .reveal-big{
      font-size: 3rem;
      animation: revealPop .5s cubic-bezier(.2,.9,.2,1) forwards;
    }

    @keyframes revealPop{
      from{ transform: scale(.6); opacity:.4; }
      to{ transform: scale(1); opacity:1; }
    }

    .reveal-text{
      margin-top: 8px;
      color: rgba(255,230,242,.92);
      line-height: 1.5;
      font-weight: 700;
    }

    .gift-link{
      margin-top: 12px;
      display:inline-block;
      text-decoration:none;
      background: rgba(255,255,255,.12);
      color: rgba(255,230,242,.92);
      border: 1px solid rgba(255,200,221,.22);
      box-shadow: 0 14px 45px rgba(0,0,0,.18);
    }

    .gift-link:hover{
      filter: brightness(1.08);
      transform: translateY(-2px);
    }
  </style>
</head>

<body>
  <div class="fog"></div>
  <div class="hearts-container" id="heartsContainer"></div>

  <!-- üéµ Music toggle -->
  <button class="music-toggle" id="musicToggle" type="button" aria-label="Toggle music">
    <span class="dot" aria-hidden="true"></span>
    <span id="musicLabel">Music: Off</span>
  </button>

  <!-- üéµ Your MP3 -->
  <audio id="bgMusic" preload="auto" loop playsinline>
    <source src="https://storage.googleapis.com/media.utg-media.com/PARTYNEXTDOOR%20Drake%20-%20SOMEBODY%20LOVES%20ME.mp3" type="audio/mpeg" />
  </audio>

  <div class="card-container" id="cardContainer">
    <div class="card">

      <div class="initial-content" id="initialContent">
        <div class="top-bow">
          <span class="mini">‚ú®</span><span class="mini">üéÄ</span><span class="mini">‚ú®</span>
        </div>

        <div class="heart-3d" id="bigHeart">üíñ</div>
        <h1>Will You Be My Valentine?</h1>
        <p class="subtitle">I promise to give you the world one day ‚ú®<br/>and will always promise that. Always.üçì</p>

        <div class="buttons-container" id="buttonsContainer">
          <button class="btn btn-yes" id="yesBtn">Yes! üíï</button>
          <button class="btn btn-no" id="noBtn">No</button>
        </div>

        <div class="hint">Tip: The <b>No</b> button is shy‚Ä¶ but it never leaves üëÄ</div>
      </div>

      <div class="success-message" id="successMessage">
        <div class="success-hearts">üíïüíñüíï</div>
        <h2>Yay! I‚Äôm So Happy!</h2>
        <p id="typewriter"></p>

        <div class="surprise-wrap" id="surpriseWrap" style="display:none;">
          <button class="btn btn-yes" id="surpriseBtn" type="button">
            Show my surprise üé•
          </button>

          <div class="video-wrap" id="videoWrap" style="display:none;">
            <div class="video-frame">
              <video id="surpriseVideo" controls playsinline preload="metadata">
                <source src="https://storage.googleapis.com/media.utg-media.com/Whatcha%20Say.mp4" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
            </div>
          </div>

          <!-- üéÅ GIFT REVEAL (HIDDEN UNTIL VIDEO ENDS) -->
          <div class="gift-wrap" id="giftWrap" style="display:none;">
            <div class="gift-card">
              <div class="gift-top">
                <div class="gift-icon" id="giftIcon">üéÅ</div>
                <div class="gift-title">Okay‚Ä¶ one more thing üíï</div>
              </div>

              <div class="gift-sub">Tap to open your gift üëá</div>

              <button class="btn btn-yes gift-btn" id="giftBtn" type="button">
                Open my gift ‚ú®
              </button>

              <div class="gift-reveal" id="giftReveal" style="display:none;">
                <div class="reveal-big">üíù</div>
                <div class="reveal-text">
                  Surprise date night üòå<br/>
                  I‚Äôm taking you out ‚Äî you just show up pretty üíï
                </div>

                <!-- Optional: add a link button -->
                <a class="btn gift-link" id="giftLink" href="#" target="_blank" rel="noopener">
                  Pick a day üìÖ
                </a>
              </div>
            </div>
          </div>
        </div><!-- /surpriseWrap -->
      </div><!-- /successMessage -->

    </div><!-- /card -->
  </div><!-- /cardContainer -->

  <script>
    /* ======================================
       HEART BACKGROUND
    ====================================== */
    const heartsContainer = document.getElementById("heartsContainer");
    const heartEmojis = ["üíï","üíñ","üíó","üíì","üíù","üíò","‚ù§Ô∏è","ü©∑","üíû","‚ú®"];

    function createFloatingHeart(){
      const heart = document.createElement("div");
      heart.className = "floating-heart";
      heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.animationDuration = (6 + Math.random() * 6) + "s";
      heart.style.animationDelay = (Math.random() * 1.6) + "s";
      heart.style.fontSize = (1.4 + Math.random() * 1.8) + "rem";
      heartsContainer.appendChild(heart);
      setTimeout(() => heart.remove(), 14000);
    }
    for (let i = 0; i < 18; i++) setTimeout(createFloatingHeart, i * 240);
    setInterval(createFloatingHeart, 780);

    /* ======================================
       MUSIC (autoplay attempt + toggle)
    ====================================== */
    const bgMusic = document.getElementById("bgMusic");
    const musicToggle = document.getElementById("musicToggle");
    const musicLabel  = document.getElementById("musicLabel");
    let musicOn = false;

    function setMusicUI(){
      musicToggle.classList.toggle("on", musicOn);
      musicLabel.textContent = "Music: " + (musicOn ? "On" : "Off");
    }

    async function startMusicAutoplay(){
      bgMusic.volume = 0.6;
      bgMusic.muted = true;

      try{
        await bgMusic.play();
        setTimeout(() => {
          bgMusic.muted = false;
          musicOn = true;
          setMusicUI();
        }, 350);
      } catch (e){
        const enableOnce = async () => {
          try{
            bgMusic.muted = false;
            bgMusic.volume = 0.6;
            await bgMusic.play();
            musicOn = true;
            setMusicUI();
          }catch(_){}
        };
        document.addEventListener("pointerdown", enableOnce, { once: true });
      }
    }
    window.addEventListener("load", startMusicAutoplay);

    async function toggleMusic(){
      musicOn = !musicOn;
      setMusicUI();
      try{
        if (musicOn) {
          bgMusic.muted = false;
          bgMusic.volume = 0.6;
          await bgMusic.play();
        } else {
          bgMusic.pause();
        }
      }catch(e){}
    }
    musicToggle.addEventListener("click", toggleMusic);
    setMusicUI();

    // Smooth fade helper
    function fadeAudio(audioEl, targetVolume, durationMs=600, pauseWhenZero=false){
      const start = audioEl.volume;
      const diff = targetVolume - start;
      const startTime = performance.now();

      function tick(now){
        const t = Math.min(1, (now - startTime) / durationMs);
        audioEl.volume = Math.max(0, Math.min(1, start + diff * t));
        if (t < 1){
          requestAnimationFrame(tick);
        } else if (pauseWhenZero && targetVolume === 0){
          audioEl.pause();
        }
      }
      requestAnimationFrame(tick);
    }

    /* ======================================
       BUTTONS + FUN
    ====================================== */
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const initialContent = document.getElementById("initialContent");
    const successMessage = document.getElementById("successMessage");
    const cardContainer = document.getElementById("cardContainer");
    const typewriterEl = document.getElementById("typewriter");

    const surpriseWrap   = document.getElementById("surpriseWrap");
    const surpriseBtn    = document.getElementById("surpriseBtn");
    const videoWrap      = document.getElementById("videoWrap");
    const surpriseVideo  = document.getElementById("surpriseVideo");

    // üéÅ Gift elements
    const giftWrap   = document.getElementById("giftWrap");
    const giftBtn    = document.getElementById("giftBtn");
    const giftReveal = document.getElementById("giftReveal");
    const giftIcon   = document.getElementById("giftIcon");

    // Show gift AFTER video finishes
    surpriseVideo.addEventListener("ended", () => {
      giftWrap.style.display = "block";
      giftWrap.scrollIntoView({ behavior: "smooth", block: "center" });
    });

    // Open gift
    giftBtn.addEventListener("click", () => {
      giftReveal.style.display = "block";
      if (giftIcon) giftIcon.textContent = "üéâ";
      giftReveal.scrollIntoView({ behavior: "smooth", block: "center" });
    });

    // Video -> manage music fade
    surpriseVideo.addEventListener("play", () => {
      fadeAudio(bgMusic, 0, 700, true);
      musicOn = false;
      setMusicUI();
    });
    function resumeMusicSoft(){
      bgMusic.muted = false;
      bgMusic.play().then(() => {
        bgMusic.volume = 0;
        fadeAudio(bgMusic, 0.6, 900, false);
        musicOn = true;
        setMusicUI();
      }).catch(()=>{});
    }
    surpriseVideo.addEventListener("pause", resumeMusicSoft);
    surpriseVideo.addEventListener("ended", resumeMusicSoft);

    let escapeCount = 0;
    let lastPos = null;
    let movedToBody = false;
    let popupEl = null;
    let typingTimer = null;

    const funnyMessages = [
      "Nice try üòè","Nope!","Too slow üí®","Hehe üòå","Not today!",
      "Aww ü•∫","Just say yes üíñ","Please? üôè","Come onnn üíï","I‚Äôm slippery üßº","You can‚Äôt catch me üòé"
    ];
    const popupMessages = [
      "‚ö†Ô∏è This option is currently unavailable.",
      "üö´ Error: Too cute to decline.",
      "üîí Locked for your happiness.",
      "üíò The 'No' button is in witness protection.",
      "üò§ Please stop chasing the No button."
    ];

    function distance(x1,y1,x2,y2){
      const dx = x1-x2, dy = y1-y2;
      return Math.sqrt(dx*dx + dy*dy);
    }

    function showPopup(text){
      if (popupEl) {
        popupEl.classList.add("out");
        setTimeout(() => popupEl?.remove(), 180);
      }
      popupEl = document.createElement("div");
      popupEl.className = "popup";
      popupEl.textContent = text;
      document.body.appendChild(popupEl);

      setTimeout(() => {
        if (!popupEl) return;
        popupEl.classList.add("out");
        setTimeout(() => popupEl?.remove(), 220);
      }, 900);
    }

    function sparkleBurst(x, y){
      const sparkles = ["‚ú®","üí´","üåü","ü´ß","üíñ"];
      for (let i = 0; i < 7; i++){
        const sp = document.createElement("div");
        sp.className = "sparkle";
        sp.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
        sp.style.left = (x + (Math.random()*140 - 70)) + "px";
        sp.style.top  = (y + (Math.random()*60 - 20)) + "px";
        document.body.appendChild(sp);
        setTimeout(() => sp.remove(), 1000);
      }
    }

    function heartTrail(x, y){
      const hearts = ["üíû","üíï","üíñ","üíó","ü©∑"];
      const t = document.createElement("div");
      t.className = "trail-heart";
      t.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      t.style.left = x + "px";
      t.style.top  = y + "px";
      t.style.fontSize = (16 + Math.random()*16) + "px";
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 650);
    }

    function ensureNoInBody(){
      if (movedToBody) return;

      const placeholder = document.createElement("span");
      placeholder.style.display = "inline-block";
      placeholder.style.width  = noBtn.offsetWidth + "px";
      placeholder.style.height = noBtn.offsetHeight + "px";
      noBtn.parentNode.insertBefore(placeholder, noBtn);

      document.body.appendChild(noBtn);
      noBtn.style.position = "fixed";
      noBtn.style.left = "50%";
      noBtn.style.top = "50%";
      noBtn.style.transform = "translate(-50%, -50%)";
      noBtn.style.zIndex = "2147483647";
      movedToBody = true;
    }

    function getSafeRandomPosition(btnW, btnH){
      const pad = 18;
      const maxX = Math.max(pad, window.innerWidth  - btnW - pad);
      const maxY = Math.max(pad, window.innerHeight - btnH - pad);

      let x, y, attempts = 0;
      do{
        x = pad + Math.random() * (maxX - pad);
        y = pad + Math.random() * (maxY - pad);
        attempts++;
      } while (attempts < 30 && lastPos && distance(x, y, lastPos.x, lastPos.y) < 200);

      lastPos = { x, y };
      return { x, y };
    }

    function growYesRidiculously(){
      const scale = Math.min(1 + escapeCount * 0.07, 2.15);
      yesBtn.style.transform = `scale(${scale}) translateY(-2px)`;
      yesBtn.style.filter = `brightness(${Math.min(1.25, 1 + escapeCount*0.03)})`;
      yesBtn.style.boxShadow = `0 26px 90px rgba(255,107,157,.55), 0 0 75px rgba(255,107,157,.35)`;
    }

    function moveNoButton(){
      ensureNoInBody();
      escapeCount++;

      const btnW = noBtn.offsetWidth;
      const btnH = noBtn.offsetHeight;
      const { x, y } = getSafeRandomPosition(btnW, btnH);

      const centerX = x + btnW/2;
      const centerY = y + btnH/2;

      for (let i = 0; i < 4; i++){
        setTimeout(() => heartTrail(centerX + (Math.random()*40-20), centerY + (Math.random()*30-15)), i*30);
      }

      noBtn.style.transition = "left .14s ease, top .14s ease, transform .14s ease";
      noBtn.style.transform = "scale(.85) rotate(-5deg)";
      requestAnimationFrame(() => {
        noBtn.style.left = x + "px";
        noBtn.style.top  = y + "px";
        noBtn.style.transform = "scale(1.06) rotate(3deg)";
        setTimeout(() => (noBtn.style.transform = "scale(1) rotate(0deg)"), 140);
      });

      const msg = funnyMessages[Math.min(escapeCount - 1, funnyMessages.length - 1)];
      noBtn.textContent = msg;
      setTimeout(() => (noBtn.textContent = "No"), 650);

      showPopup(popupMessages[Math.floor(Math.random() * popupMessages.length)]);
      sparkleBurst(centerX, centerY);
      growYesRidiculously();
    }

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); moveNoButton(); });
    noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); e.stopPropagation(); moveNoButton(); }, { passive: false });

    window.addEventListener("resize", () => {
      if (!movedToBody) return;
      const rect = noBtn.getBoundingClientRect();
      const pad = 12;
      let nx = rect.left, ny = rect.top;

      if (rect.right > window.innerWidth - pad) nx = window.innerWidth - rect.width - pad;
      if (rect.left < pad) nx = pad;
      if (rect.bottom > window.innerHeight - pad) ny = window.innerHeight - rect.height - pad;
      if (rect.top < pad) ny = pad;

      noBtn.style.left = nx + "px";
      noBtn.style.top  = ny + "px";
    });

    /* ======================================
       TYPEWRITER
    ====================================== */
    function typewriter(text, speed=22, onDone){
      if (typingTimer) clearInterval(typingTimer);
      typewriterEl.textContent = "";
      let i = 0;

      typingTimer = setInterval(() => {
        typewriterEl.textContent += text[i];
        i++;
        if (i >= text.length){
          clearInterval(typingTimer);
          typingTimer = null;
          if (typeof onDone === "function") onDone();
        }
      }, speed);
    }

    /* ======================================
       SURPRISE BUTTON CLICK (set once)
    ====================================== */
    surpriseBtn.addEventListener("click", async () => {
      videoWrap.style.display = "block";
      videoWrap.scrollIntoView({ behavior: "smooth", block: "center" });

      // best autoplay attempt:
      // - muted autoplay is most reliable
      // - then unmute if allowed
      surpriseVideo.muted = true;
      try { await surpriseVideo.play(); } catch(e) {}

      setTimeout(async () => {
        try{
          surpriseVideo.muted = false;
          await surpriseVideo.play();
        }catch(e){}
      }, 150);
    });

    /* ======================================
       YES CLICK
    ====================================== */
    yesBtn.addEventListener("click", () => {
      initialContent.classList.add("hidden");
      successMessage.classList.add("show");

      createConfetti();
      for (let i = 0; i < 34; i++) setTimeout(createFloatingHeart, i * 45);

      cardContainer.animate(
        [{ transform: "scale(1)" }, { transform: "scale(1.02)" }, { transform: "scale(1)" }],
        { duration: 520, easing: "cubic-bezier(.2,.8,.2,1)" }
      );

      const message =
`You‚Äôve made me the luckiest person MJ ü•∞

Officially:
üíò You = my Valentine
üçì Snacks = mandatory
üíñ Smiles = daily

Now‚Ä¶ One More Suprise
(Watch until the last second)üëáüëá`;

      typewriter(message, 18, () => {
        surpriseWrap.style.display = "flex";
      });
    });

    /* ======================================
       CONFETTI
    ====================================== */
    function createConfetti(){
      const colors = ["#ff6b9d","#ff8fab","#ffc8dd","#ffafcc","#ff69b4","#ff1493","#fff"];
      for (let i = 0; i < 120; i++){
        setTimeout(() => {
          const c = document.createElement("div");
          c.className = "confetti";
          c.style.left = Math.random() * 100 + "vw";
          c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          c.style.borderRadius = Math.random() > 0.55 ? "50%" : "3px";
          c.style.width  = (5 + Math.random() * 10) + "px";
          c.style.height = (5 + Math.random() * 10) + "px";
          c.style.animationDuration = (2.0 + Math.random() * 2.3) + "s";
          document.body.appendChild(c);
          setTimeout(() => c.remove(), 4200);
        }, i * 18);
      }
    }

    /* ======================================
       PARALLAX
    ====================================== */
    document.addEventListener("mousemove", (e) => {
      const xAxis = (window.innerWidth / 2 - e.pageX) / 30;
      const yAxis = (window.innerHeight / 2 - e.pageY) / 30;
      cardContainer.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
    });
  </script>
</body>
</html>
